PHASE 2: INSIGHTS TAB + VALUE REALIZATION IMPLEMENTATION

Build in two parts:
- Part A: Insights tab shell with sub-navigation
- Part B: Value Realization full implementation

Follow ALL replit.md guidelines. Reuse patterns identified in architectural assessment.

=== PART A: INSIGHTS TAB SHELL ===

STEP A1: Create InsightsPage with Sub-Tab Structure

Location: client/src/pages/InsightsPage.tsx

Pattern: Follow Admin panel tab pattern using shadcn Tabs

URL Structure:
- /insights → defaults to /insights/value-realization
- /insights/value-realization
- /insights/operating-model
- /insights/capability-transition
- /insights/responsible-ai

Sub-tabs:
1. Value Realization (default) → Full build in Part B
2. Operating Model → Placeholder initially, then TOM analytics view
3. Capability Transition → Placeholder "Coming Soon"
4. Responsible AI → Placeholder initially, then consolidated RAI view

STEP A2: Add Route to App

In client/src/App.tsx (or routing config):
- Add /insights route pointing to InsightsPage
- Add /insights/:subTab route for deep linking

STEP A3: Add Navigation Tab

Update main navigation (likely in Layout or Header component):

Current:  Dashboard | Explorer | AI Assessment | Admin
New:      Dashboard | Explorer | Insights | AI Assessment | Admin

STEP A4: Placeholder Components

Create placeholder LEGO blocks for unbuilt sub-tabs:

InsightsPlaceholderLegoBlock:
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│     [Icon]                                                  │
│                                                             │
│     Capability Transition                                   │
│     Coming Soon                                             │
│                                                             │
│     Track staffing curves, independence metrics,            │
│     and knowledge transfer milestones.                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘

Props: { title, description, icon }

Use for:
- Capability Transition (until Phase 3)
- Any other future sub-tabs

STEP A5: Dashboard Integration

Add click handlers to existing dashboard summary cards:
- TOM Phase Breakdown → navigates to /insights/operating-model
- Value summary (when built) → navigates to /insights/value-realization

Use Wouter's useLocation for navigation.

Checkpoint after Part A complete. Verify:
□ /insights route works
□ Sub-tab navigation works
□ Deep links work (/insights/operating-model)
□ Placeholders display for unbuilt tabs
□ Main nav shows Insights tab
□ Existing functionality unchanged

=== PART B: VALUE REALIZATION IMPLEMENTATION ===

STEP B1: Schema - metadata_config.valueRealizationConfig

Add valueRealizationConfig JSONB to metadata_config:

{
  "enabled": "true",
  "kpiLibrary": {
    "cycle_time_reduction": {
      "id": "cycle_time_reduction",
      "name": "Cycle Time Reduction",
      "description": "Reduction in end-to-end processing time",
      "unit": "%",
      "direction": "decrease",
      "applicableUseCaseTypes": ["claims_triage", "underwriting", "fnol"],
      "maturityRules": [
        {
          "level": "advanced",
          "conditions": {
            "dataReadiness": { "min": 4 },
            "technicalComplexity": { "max": 2 },
            "adoptionReadiness": { "min": 4 }
          },
          "range": { "min": 60, "max": 70 },
          "confidence": "high"
        },
        {
          "level": "developing",
          "conditions": {
            "dataReadiness": { "min": 3 },
            "technicalComplexity": { "max": 3 }
          },
          "range": { "min": 40, "max": 50 },
          "confidence": "medium"
        },
        {
          "level": "foundational",
          "conditions": {},
          "range": { "min": 20, "max": 30 },
          "confidence": "low"
        }
      ]
    },
    "cost_per_transaction": {
      "id": "cost_per_transaction",
      "name": "Cost Per Transaction Reduction",
      "description": "Reduction in cost to process each transaction",
      "unit": "%",
      "direction": "decrease",
      "applicableUseCaseTypes": ["claims_triage", "premium_audit", "underwriting"],
      "maturityRules": [
        {
          "level": "advanced",
          "conditions": { "dataReadiness": { "min": 4 }, "changeImpact": { "max": 2 } },
          "range": { "min": 25, "max": 35 },
          "confidence": "high"
        },
        {
          "level": "developing",
          "conditions": { "dataReadiness": { "min": 3 } },
          "range": { "min": 15, "max": 25 },
          "confidence": "medium"
        },
        {
          "level": "foundational",
          "conditions": {},
          "range": { "min": 8, "max": 15 },
          "confidence": "low"
        }
      ]
    },
    "accuracy_improvement": {
      "id": "accuracy_improvement",
      "name": "Accuracy Improvement",
      "description": "Improvement in decision/prediction accuracy",
      "unit": "%",
      "direction": "increase",
      "applicableUseCaseTypes": ["fraud_detection", "underwriting", "pricing"],
      "maturityRules": [
        {
          "level": "advanced",
          "conditions": { "dataReadiness": { "min": 4 }, "modelRisk": { "max": 2 } },
          "range": { "min": 15, "max": 25 },
          "confidence": "high"
        },
        {
          "level": "developing",
          "conditions": { "dataReadiness": { "min": 3 } },
          "range": { "min": 8, "max": 15 },
          "confidence": "medium"
        },
        {
          "level": "foundational",
          "conditions": {},
          "range": { "min": 3, "max": 8 },
          "confidence": "low"
        }
      ]
    },
    "loss_ratio_improvement": {
      "id": "loss_ratio_improvement",
      "name": "Loss Ratio Improvement",
      "description": "Reduction in loss ratio (basis points)",
      "unit": "bps",
      "direction": "decrease",
      "applicableUseCaseTypes": ["fraud_detection", "claims_triage", "underwriting"],
      "maturityRules": [
        {
          "level": "advanced",
          "conditions": { "dataReadiness": { "min": 4 }, "modelRisk": { "max": 2 }, "riskReduction": { "min": 4 } },
          "range": { "min": 50, "max": 100 },
          "confidence": "high"
        },
        {
          "level": "developing",
          "conditions": { "dataReadiness": { "min": 3 } },
          "range": { "min": 25, "max": 50 },
          "confidence": "medium"
        },
        {
          "level": "foundational",
          "conditions": {},
          "range": { "min": 10, "max": 25 },
          "confidence": "low"
        }
      ]
    },
    "fte_efficiency": {
      "id": "fte_efficiency",
      "name": "FTE Efficiency Gain",
      "description": "FTE hours saved or reallocated",
      "unit": "hours/month",
      "direction": "increase",
      "applicableUseCaseTypes": ["claims_triage", "underwriting", "premium_audit", "fnol"],
      "maturityRules": [
        {
          "level": "advanced",
          "conditions": { "dataReadiness": { "min": 4 }, "adoptionReadiness": { "min": 4 } },
          "range": { "min": 500, "max": 1000 },
          "confidence": "high"
        },
        {
          "level": "developing",
          "conditions": { "dataReadiness": { "min": 3 } },
          "range": { "min": 200, "max": 500 },
          "confidence": "medium"
        },
        {
          "level": "foundational",
          "conditions": {},
          "range": { "min": 50, "max": 200 },
          "confidence": "low"
        }
      ]
    }
  },
  "calculationConfig": {
    "roiFormula": "(cumulativeValue - totalInvestment) / totalInvestment * 100",
    "breakevenFormula": "totalInvestment / monthlyValue",
    "defaultCurrency": "GBP",
    "fiscalYearStart": 4
  }
}

Checkpoint after schema.

STEP B2: Schema - use_cases.valueRealization Field

Add valueRealization JSONB field to use_cases (nullable):

{
  "selectedKpis": ["cycle_time_reduction", "cost_per_transaction"],
  "kpiValues": {
    "cycle_time_reduction": {
      "baselineValue": 45,
      "baselineUnit": "minutes",
      "targetValue": 18,
      "targetUnit": "minutes",
      "derivedMaturityLevel": "developing",
      "derivedRange": { "min": 40, "max": 50 },
      "derivedConfidence": "medium",
      "isOverridden": false,
      "overrideValue": null,
      "overrideReason": null
    }
  },
  "investment": {
    "initialInvestment": 150000,
    "ongoingMonthlyCost": 5000,
    "currency": "GBP"
  },
  "tracking": {
    "entries": [
      {
        "month": "2025-01",
        "actuals": {
          "cycle_time_reduction": { "value": 38, "unit": "minutes" }
        },
        "notes": "Initial deployment"
      }
    ]
  },
  "calculatedMetrics": {
    "currentRoi": 45.5,
    "projectedBreakevenMonth": "2025-04",
    "cumulativeValueGbp": 218000,
    "lastCalculated": "2025-02-15T10:30:00Z"
  }
}

Checkpoint after schema.

STEP B3: Shared Types & Derivation Logic

Create shared/valueRealization.ts:

Interfaces:
- KpiDefinition, MaturityRule, KpiValue, ValueRealization
- PortfolioValueSummary

Functions:
- deriveMaturityLevel(scores, maturityRules) → { level, range, confidence, matchedConditions }
- calculateRoi(cumulativeValue, totalInvestment) → number
- calculateBreakeven(investment, monthlyValue) → string (month)
- calculateCumulativeValue(tracking, kpiValues) → number
- aggregatePortfolioValue(useCases[]) → PortfolioValueSummary

Checkpoint after shared module.

STEP B4: API Endpoints

Add to server/routes.ts:

GET  /api/value/config
  - Returns valueRealizationConfig from metadata_config

PUT  /api/value/config
  - Updates valueRealizationConfig (admin only)

GET  /api/value/kpi-library
  - Returns KPI library for dropdowns

GET  /api/use-cases/:id/value
  - Returns use case valueRealization with fresh maturity derivation

PUT  /api/use-cases/:id/value
  - Updates valueRealization, recalculates metrics server-side

POST /api/use-cases/:id/value/tracking
  - Adds monthly tracking entry, triggers recalculation

GET  /api/value/portfolio-summary
  - SERVER-SIDE aggregation (important for consistency)
  - Returns: totalInvestment, cumulativeValue, portfolioRoi, avgBreakeven
  - Groups by TOM phase
  - Groups by quadrant

Checkpoint after API.

STEP B5: UI - Insights > Value Realization Sub-Tab

Location: client/src/components/insights/ValueRealizationView.tsx

Layout:
┌─────────────────────────────────────────────────────────────────────────┐
│ Value Realization                                                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  PORTFOLIO SUMMARY                                                      │
│  ┌────────────┬────────────┬────────────┬────────────┐                 │
│  │ £2.1M      │ £4.8M      │ 127%       │ Month 7    │                 │
│  │ Investment │ Value      │ ROI        │ Avg Break  │                 │
│  └────────────┴────────────┴────────────┴────────────┘                 │
│                                                                         │
│  VALUE BY TOM PHASE                                                     │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ Foundation: £0 | Strategic: £1.2M | Transition: £3.6M           │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  USE CASES WITH VALUE TRACKING                          [Filter] [Add] │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ Title          │ Phase      │ Investment │ Value   │ ROI  │ ▶   │   │
│  │ Claims Triage  │ Strategic  │ £150K      │ £218K   │ 45%  │     │   │
│  │ Fraud Detect   │ Transition │ £200K      │ £890K   │ 345% │     │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  VALUE TREND (CUMULATIVE)                                              │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ [Line chart showing cumulative value over months]               │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

LEGO Components to create:
- PortfolioValueSummaryLegoBlock (4 metric cards)
- ValueByPhaseLegoBlock (horizontal bar/breakdown)
- ValueTrackingTableLegoBlock (use case list with value data)
- ValueTrendChartLegoBlock (Recharts line chart)

Clicking a row opens Use Case Detail with Value tab focused.

Checkpoint after portfolio view.

STEP B6: UI - Use Case Detail > Value Realization Tab

Add tab to CRUDUseCaseModal (per-use-case data entry):

┌─────────────────────────────────────────────────────────────────────┐
│ [Overview] [Scoring] [Value Realization] [Attachments]              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ SELECT KPIs                                              [+ Add]    │
│ ┌─────────────────────────────────────────────────────────────────┐│
│ │ ☑ Cycle Time Reduction                                          ││
│ │ ☑ Cost Per Transaction                                          ││
│ │ ☐ Accuracy Improvement                                          ││
│ └─────────────────────────────────────────────────────────────────┘│
│                                                                     │
│ KPI CONFIGURATION                                                   │
│ ┌─────────────────────────────────────────────────────────────────┐│
│ │ Cycle Time Reduction                                            ││
│ │ Maturity: Developing ●●○  |  Expected: 40-50% reduction        ││
│ │ Based on: Data Readiness 3/5 ✓, Tech Complexity 3/5 ✓          ││
│ │                                                                 ││
│ │ Baseline: [45] minutes   Target: [18] minutes                   ││
│ │ ☐ Override system estimate  [Reason: ________]                  ││
│ └─────────────────────────────────────────────────────────────────┘│
│                                                                     │
│ INVESTMENT                                                          │
│ Initial: [£150,000]    Monthly Run Cost: [£5,000]                  │
│                                                                     │
│ MONTHLY TRACKING                                      [+ Add Entry] │
│ ┌──────────┬───────────────┬─────────────┬───────────────────────┐ │
│ │ Month    │ Cycle Time    │ Cost/Txn    │ Notes                 │ │
│ │ Jan 2025 │ 38 mins       │ £110        │ Initial deployment    │ │
│ │ Feb 2025 │ 32 mins       │ £102        │ 75% adoption          │ │
│ └──────────┴───────────────┴─────────────┴───────────────────────┘ │
│                                                                     │
│ CALCULATED METRICS                                                  │
│ ROI: 45.5%  |  Breakeven: Apr 2025  |  Cumulative: £218K          │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘

LEGO Components:
- KpiSelectorLegoBlock
- KpiConfigCardLegoBlock (shows maturity, baseline/target, override option)
- InvestmentInputLegoBlock
- MonthlyTrackingTableLegoBlock
- CalculatedMetricsLegoBlock

Checkpoint after use case detail tab.

STEP B7: Admin > Value Configuration Tab

Add tab to Admin panel (follow TOM Configuration pattern):

- Enable/disable value realization
- View/edit KPI library
- Add custom KPIs
- Edit maturity rules
- Configure calculation settings

Checkpoint after admin config.

STEP B8: Documentation

Update replit.md with:
- Insights tab structure
- Value Realization feature overview
- valueRealizationConfig schema
- use_cases.valueRealization schema
- API endpoints
- LEGO components created

=== VALIDATION CRITERIA ===

□ Insights tab appears in main navigation
□ Sub-tab navigation works with deep links
□ Value Realization portfolio view shows aggregated data
□ Use case detail has Value Realization tab
□ KPI maturity derivation uses existing 10-lever scores
□ User can override derived values with reason
□ Monthly tracking entries can be added
□ ROI/breakeven calculated server-side
□ Value grouped by TOM phase
□ Admin can configure KPI library
□ Placeholder tabs show for unbuilt features
□ Dashboard cards link to Insights sub-tabs
□ Existing functionality unchanged

=== CHECKPOINT SEQUENCE ===

A1. InsightsPage shell with routing
A2. Routes configured
A3. Main nav updated
A4. Placeholder components
A5. Dashboard linking
-- Part A Complete --
B1. Schema: valueRealizationConfig
B2. Schema: use_cases.valueRealization
B3. Shared types and derivation
B4. API endpoints
B5. Insights > Value Realization view
B6. Use Case Detail > Value tab
B7. Admin > Value Configuration
B8. Documentation
-- Part B Complete --

Start with Step A1. Checkpoint after each step.