Database Update Commands
Execute these exact database updates to improve Q2-Q5 question structure and flow:
Q2: Business Lines & Distribution
sqlUPDATE questions 
SET 
  question_text = 'Business Lines & Distribution - How is your premium distributed across business lines?',
  help_text = 'Provide percentage allocation and growth trends for each line of business. This will establish your business composition baseline for performance analysis.'
WHERE question_order = 2 
AND section_id IN (SELECT id FROM sections WHERE section_number = 1);
Q3: Distribution Channels (Keep existing type, improve validation message)
sql-- Update question text and help text only - keep percentage_target type
UPDATE questions 
SET 
  question_text = 'Distribution Channels - What are your primary distribution channels?',
  help_text = 'Specify how your premium is distributed across different sales channels. Percentages should total approximately 100% to reflect your actual distribution strategy.',
  metadata = jsonb_set(
    COALESCE(metadata, '{}'),
    '{questionData,allocationMessage}',
    '"Percentages should total approximately 100%. Adjust to reflect your actual distribution strategy."'
  )
WHERE question_order = 3 
AND section_id IN (SELECT id FROM sections WHERE section_number = 1);
Q3: Admin Configuration Update (Use existing toggle system)
sql-- Enable 100% target validation via admin configuration
INSERT INTO question_configurations (question_id, config_key, config_value)
SELECT 
  q.id,
  'targetTotal',
  '100'
FROM questions q
JOIN sections s ON q.section_id = s.id
WHERE q.question_order = 3 AND s.section_number = 1
ON CONFLICT (question_id, config_key) 
DO UPDATE SET config_value = '100';

-- Update the validation message
INSERT INTO question_configurations (question_id, config_key, config_value)
SELECT 
  q.id,
  'validationMessage',
  'Percentages should total approximately 100%'
FROM questions q
JOIN sections s ON q.section_id = s.id
WHERE q.question_order = 3 AND s.section_number = 1
ON CONFLICT (question_id, config_key) 
DO UPDATE SET config_value = 'Percentages should total approximately 100%';
Q4: Current Business Performance
sqlUPDATE questions 
SET 
  question_text = 'Current Business Performance - Let''s review key performance metrics to understand the baseline',
  help_text = 'Provide current performance metrics for your organization. Consider how these metrics vary across the business lines identified in Q2. This establishes your improvement targets for AI initiatives.',
  metadata = jsonb_set(
    COALESCE(metadata, '{}'),
    '{questionData,additionalContext}',
    '{"prompt": "Which business lines are driving performance challenges? How do these metrics compare to your strategic targets? Where do you see the biggest opportunities for AI-driven improvement?"}'
  )
WHERE question_order = 4 
AND section_id IN (SELECT id FROM sections WHERE section_number = 1);
Q5: Competitive Position
sqlUPDATE questions 
SET 
  question_text = 'Competitive Position - How does RSA compare to competitors?',
  help_text = 'Rate your competitive position across key capabilities (1=Behind, 5=Leading). Consider how competitive gaps in these areas create opportunities for AI differentiation.',
  metadata = jsonb_set(
    COALESCE(metadata, '{}'),
    '{questionData,additionalContext}',
    '{"prompt": "In which markets (referenced in Q1) do competitive gaps create the biggest AI opportunities? Which competitive weaknesses could AI help address most effectively?"}'
  )
WHERE question_order = 5 
AND section_id IN (SELECT id FROM sections WHERE section_number = 1);
Enhanced Context Integration
Update Q4 Business Performance Context
sqlUPDATE questions 
SET metadata = jsonb_set(
  metadata,
  '{questionData,metrics}',
  '[
    {"name": "combinedRatio", "label": "Combined Ratio", "suffix": "", "helpText": "Target: <100% for profitability"},
    {"name": "expenseRatio", "label": "Expense Ratio", "suffix": "", "helpText": "Administrative costs vs premium"},
    {"name": "lossRatio", "label": "Loss Ratio", "suffix": "", "helpText": "Claims costs vs premium"},
    {"name": "premiumGrowthRate", "label": "Premium Growth Rate (YoY)", "suffix": "%", "helpText": "Annual premium growth"},
    {"name": "policyRetentionRate", "label": "Policy Retention Rate", "suffix": "%", "helpText": "Customer retention percentage"},
    {"name": "avgPolicyProcessingTime", "label": "Average Policy Processing Time", "suffix": "days", "helpText": "Time from application to issuance"},
    {"name": "claimsSettlementTime", "label": "Claims Settlement Time", "suffix": "days", "helpText": "Average time to settle claims"},
    {"name": "customerSatisfactionScore", "label": "Customer Satisfaction Score (1-10)", "suffix": "/10", "helpText": "Overall customer satisfaction rating"}
  ]'
)
WHERE question_order = 4 
AND section_id IN (SELECT id FROM sections WHERE section_number = 1);
Update Q5 Competitive Position Metrics
sqlUPDATE questions 
SET metadata = jsonb_set(
  metadata,
  '{questionData,items}',
  '[
    {"id": "marketPosition", "label": "Market position in primary lines", "description": "Overall market standing in your core business lines"},
    {"id": "pricingAccuracy", "label": "Pricing accuracy", "description": "Competitive pricing capabilities and risk assessment"},
    {"id": "brokerService", "label": "Broker/agent service quality", "description": "Partner relationship quality and support"},
    {"id": "digitalExperience", "label": "Digital customer experience", "description": "Digital capabilities vs competitors"},
    {"id": "claimsProcessing", "label": "Claims processing efficiency", "description": "Speed and quality of claims handling"},
    {"id": "underwritingSpeed", "label": "Underwriting speed and accuracy", "description": "Time to quote and decision accuracy"}
  ]'
)
WHERE question_order = 5 
AND section_id IN (SELECT id FROM sections WHERE section_number = 1);
Admin Panel Configuration Updates
Fix Q3 Distribution Channels Validation
sql-- Update question configuration to enforce percentage allocation
INSERT INTO question_configurations (question_id, config_key, config_value)
SELECT 
  q.id,
  'enforceAllocation',
  'true'
FROM questions q
JOIN sections s ON q.section_id = s.id
WHERE q.question_order = 3 AND s.section_number = 1
ON CONFLICT (question_id, config_key) 
DO UPDATE SET config_value = 'true';

-- Add total validation message
INSERT INTO question_configurations (question_id, config_key, config_value)
SELECT 
  q.id,
  'allocationMessage',
  'Total must equal 100%. Adjust percentages to reflect your actual distribution strategy.'
FROM questions q
JOIN sections s ON q.section_id = s.id
WHERE q.question_order = 3 AND s.section_number = 1
ON CONFLICT (question_id, config_key) 
DO UPDATE SET config_value = 'Total must equal 100%. Adjust percentages to reflect your actual distribution strategy.';
Expected Improvements
After applying these updates:

Q2 Business Lines: Enhanced context linking to performance analysis
Q3 Distribution Channels: Now enforces 100% validation with proper percentage_allocation type
Q4 Performance: Better context prompts referencing Q2 business lines
Q5 Competitive: Enhanced context linking to Q1 markets and AI opportunities

Verification Commands
sql-- Verify updates applied correctly
SELECT 
  q.question_order,
  LEFT(q.question_text, 50) as question_preview,
  q.question_type,
  q.help_text
FROM questions q
JOIN sections s ON q.section_id = s.id
WHERE s.section_number = 1 
AND q.question_order BETWEEN 2 AND 5
ORDER BY q.question_order;
Execute these commands in sequence to implement the improved question structure and flow for Q2-Q5.